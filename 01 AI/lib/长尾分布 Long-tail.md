æ¬¢è¿è®¿é—® MyBlog: https://starwanan.github.io/#/ 

#AI/Long-tail

## é—®é¢˜ç®€ä»‹

åœ¨è‡ªç„¶æƒ…å†µä¸‹ï¼Œæ•°æ®å¾€å¾€éƒ½ä¼šå‘ˆç°å¦‚ä¸‹ç›¸åŒçš„é•¿å°¾åˆ†å¸ƒã€‚
<img src="https://s1.vika.cn/space/2023/02/15/cb3d3712cf9a458b9b600b03b3a5e8c3" alt="image.png" style="zoom:67%;" />
å¾ˆå°‘ä¸€éƒ¨åˆ†ç±»åˆ«æ‹¥æœ‰å¤§é‡æ•°æ®ï¼Œè€Œå¾ˆå¤§ä¸€éƒ¨åˆ†ç±»åˆ«åªæ‹¥æœ‰å¾ˆå°‘çš„æ•°æ®é‡ã€‚æ¯”å¦‚åœ¨åšåŠ¨ç‰©åˆ†ç±»çš„é—®é¢˜æ—¶ï¼ŒçŒ«ç‹—å¯ä»¥è½»æ¾é‡‡é›†åˆ°å¤§é‡æ•°æ®ï¼Œä½†æ˜¯é¹¦é¹‰ã€é›ªè±¹ç­‰ç¨€æœ‰åŠ¨ç‰©æˆ–å·²ç­ç»åŠ¨ç‰©çš„æ•°æ®å´å¾ˆéš¾é‡‡é›†åˆ°ã€‚

ç›´æ¥åˆ©ç”¨é•¿å°¾æ•°æ®æ¥è®­ç»ƒçš„åˆ†ç±»å’Œè¯†åˆ«ç³»ç»Ÿï¼Œ**å¾€å¾€ä¼šå¯¹å¤´éƒ¨æ•°æ®è¿‡æ‹Ÿåˆï¼Œä»è€Œåœ¨é¢„æµ‹æ—¶å¿½ç•¥å°¾éƒ¨çš„ç±»åˆ«**ã€‚

é•¿å°¾æ•ˆåº”ä¸»è¦ä½“ç°åœ¨==æœ‰ç›‘ç£==å­¦ä¹ é‡Œï¼Œæ— ç›‘ç£/è‡ªç›‘ç£å­¦ä¹ ç­‰å› ä¸ºä¸ä¾èµ–æ ‡æ³¨ï¼Œæ‰€ä»¥é•¿å°¾æ•ˆåº”ä½“ç°çš„ä¸æ˜æ˜¾ï¼Œç›®å‰ä¹Ÿç¼ºå°‘è¿™æ–¹é¢çš„ç ”ç©¶ï¼ˆä½†å¹¶ä¸ä»£è¡¨æ— ç›‘ç£/è‡ªç›‘ç£å­¦ä¹ ä¸å—é•¿å°¾æ•ˆåº”çš„å½±å“ï¼Œå› ä¸ºå›¾ç‰‡æœ¬èº«ä¹Ÿæœ‰åˆ†å¸ƒï¼Œå¸¸è§çš„å›¾æ¡ˆå’Œç½•è§çš„å›¾æ¡ˆä¹Ÿä¼šå½¢æˆè¿™æ ·çš„é•¿å°¾æ•ˆåº”ï¼Œä»è€Œä½¿æ¨¡å‹å¯¹å¸¸è§çš„å›¾æ¡ˆæ›´æ•æ„Ÿï¼‰ã€‚

## æŠ€æœ¯è·¯çº¿
å¸¸è§æ€è·¯ï¼š
1. ä»æ•°æ®å…¥æ‰‹ï¼Œé€šè¿‡è¿‡é‡‡æ ·æˆ–é™é‡‡æ ·ç­‰æ‰‹æ®µï¼Œä½¿å¾—æ¯ä¸ªbatchå†…çš„ç±»åˆ«å˜å¾—æ›´ä¸ºå‡è¡¡ä¸€äº›ï¼›
2. ä»losså…¥æ‰‹ï¼Œç»å…¸çš„åšæ³•å°±æ˜¯ç±»åˆ«$y$çš„æ ·æœ¬lossé™¤ä»¥ç±»åˆ«å‡ºç°çš„é¢‘ç‡$p(y)$ï¼›
3. ä»ç»“æœå…¥æ‰‹ï¼Œå¯¹æ­£å¸¸è®­ç»ƒå®Œçš„æ¨¡å‹åœ¨é¢„æµ‹é˜¶æ®µåšäº›è°ƒæ•´ï¼Œæ›´åå‘äºä½é¢‘ç±»åˆ«ï¼Œæ¯”å¦‚æ­£æ ·æœ¬è¿œå°‘äºè´Ÿæ ·æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¢„æµ‹ç»“æœå¤§äº0.2ï¼ˆè€Œä¸æ˜¯0.5ï¼‰éƒ½è§†ä¸ºæ­£æ ·æœ¬ã€‚

é•¿å°¾åˆ†å¸ƒçš„æœ€ç®€å•çš„ä¸¤ç±»åŸºæœ¬æ–¹æ³•æ˜¯é‡é‡‡æ ·(re-sampling)å’Œé‡åŠ æƒ(re-weighting)ã€‚è¿™ç±»æ–¹æ³•æœ¬è´¨éƒ½æ˜¯åˆ©ç”¨å·²çŸ¥çš„æ•°æ®é›†åˆ†å¸ƒï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¯¹æ•°æ®åˆ†å¸ƒè¿›è¡Œæš´åŠ›çš„hackingï¼Œå³åå‘åŠ æƒï¼Œå¼ºåŒ–å°¾éƒ¨ç±»åˆ«çš„å­¦ä¹ ï¼ŒæŠµæ¶ˆé•¿å°¾æ•ˆåº”ã€‚

### é‡é‡‡æ · re-sampling
æ—©æœŸç ”ç©¶ä¸­ä¸»è¦åŒ…å«ä¸¤ç§æ–¹æ³•ï¼š
- å¯¹å¤´éƒ¨ç±»æ¬ é‡‡æ ·(under-sampling)
- å¯¹å°¾éƒ¨ç±»è¿‡é‡‡æ ·(over-sampling)
æœ¬è´¨å…¶å®éƒ½æ˜¯å¯¹ä¸åŒç±»åˆ«çš„å›¾ç‰‡é‡‡æ ·é¢‘ç‡æ ¹æ®æ ·æœ¬æ•°é‡è¿›è¡Œåå‘åŠ æƒã€‚æ‰€ä»¥å¯ä»¥ç»Ÿç§°ä¸ºé‡é‡‡æ ·ã€‚

å…¶ä¸­æœ€å¸¸ç”¨ç­–ç•¥åˆå«ç±»åˆ«å‡è¡¡é‡‡æ ·ï¼ˆclass-balanced samplingï¼‰ã€‚ç±»åˆ«å‡è¡¡çš„æ¦‚å¿µä¸»è¦æ˜¯åŒºåˆ«äºä¼ ç»Ÿå­¦ä¹ è¿‡ç¨‹ä¸­çš„æ ·æœ¬å‡è¡¡ï¼ˆinstance-balanced samplingï¼‰ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªå›¾ç‰‡éƒ½æœ‰ç›¸åŒçš„æ¦‚ç‡è¢«é€‰ä¸­ï¼Œä¸è®ºå…¶ç±»åˆ«ã€‚è€Œç±»åˆ«å‡è¡¡é‡‡æ ·çš„æ ¸å¿ƒå°±æ˜¯æ ¹æ®ä¸åŒç±»åˆ«çš„æ ·æœ¬æ•°é‡ï¼Œå¯¹æ¯ä¸ªå›¾ç‰‡çš„é‡‡æ ·é¢‘ç‡è¿›è¡ŒåŠ æƒã€‚

**é‡‡æ ·ç­–ç•¥:**

å¼•ç”¨[Decoupling Representation and Classifier for Long-Tailed Recognition(ICLR 2020)](https://arxiv.org/pdf/1910.09217v2)çš„é€šç”¨å…¬å¼æ¥è¡¨ç¤º:
$$
ğ‘_ğ‘—=\frac{ğ‘›^ğ‘_ğ‘—}{\sum^ğ¶_{ğ‘–=1}ğ‘›^ğ‘_ğ‘—}
$$
- p_j: ä»ç±»åˆ«j ä¸­é‡‡æ ·ä¸€ä¸ªæ•°æ®çš„æ¦‚ç‡
- $n_j$: ç¬¬j ç±»çš„æ ·æœ¬æ•°é‡
- $C$: è®­ç»ƒç±»åˆ«æ•°é‡
- $q \in [0, 1]$
	- instance-balanced sampling, q = 1, æ¯å¼ å›¾éƒ½æœ‰ç›¸ç­‰æ¦‚ç‡è¢«é‡‡æ ·
	- Class-balanced sampling, q = 0, $p_j^{CB} = \frac{1}{C}$, æ¯ç±»éƒ½æœ‰ç›¸ç­‰çš„æ¦‚ç‡è¢«é‡‡æ ·
	- Square-root sampling, q = 1/2, ä¸€äº›å˜ä½“
	åœ¨ $q \in [0,1)$ çš„æ—¶å€™ï¼Œå°¾éƒ¨ç±»åˆ«çš„æ ·æœ¬å›¾ç‰‡ä¼šæ¯”å¤´éƒ¨ç±»åˆ«æœ‰æ›´é«˜çš„æ¦‚ç‡è¢«é‡‡æ ·åˆ°ã€‚q = 0 å°±æ˜¯ç±»åˆ«å‡è¡¡é‡‡æ ·ï¼Œæ‰€æœ‰çš„ç±»åˆ«é‡‡æ ·ç›¸åŒæ•°é‡çš„æ ·æœ¬ã€‚ä½†æ˜¯å°¾éƒ¨ç±»åˆ«ä¼šè¢«åå¤é‡‡æ ·ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¼šåšæ•°æ®å¢å¼ºï¼Œæ¯”å¦‚åè½¬ï¼Œéšæœºè£å‰ª

é‡é‡‡æ ·å°±æ˜¯åœ¨å·²æœ‰æ•°æ®ä¸å‡è¡¡çš„æƒ…å†µä¸‹ï¼Œäººä¸ºçš„è®©æ¨¡å‹å­¦ä¹ æ—¶æ¥è§¦åˆ°çš„è®­ç»ƒæ ·æœ¬æ˜¯ç±»åˆ«å‡è¡¡çš„ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹å¤´éƒ¨æ•°æ®çš„è¿‡æ‹Ÿåˆã€‚
- å°¾éƒ¨çš„å°‘é‡æ•°æ®å¾€å¾€è¢«åå¤å­¦ä¹ ï¼Œç¼ºå°‘è¶³å¤Ÿå¤šçš„æ ·æœ¬å·®å¼‚ï¼Œä¸å¤Ÿé²æ£’
- å¤´éƒ¨æ‹¥æœ‰è¶³å¤Ÿå·®å¼‚çš„å¤§é‡æ•°æ®åˆå¾€å¾€å¾—ä¸åˆ°å……åˆ†å­¦ä¹ 


### é‡åŠ æƒ re-weighting
é‡åŠ æƒä¸»è¦ä½“ç°åœ¨åˆ†ç±»çš„lossä¸Šã€‚lossè®¡ç®—æ¯”é‡‡æ ·æ›´åŠ çµæ´»æ–¹ä¾¿ã€‚
- åŸºäºç±»åˆ«åˆ†å¸ƒçš„åå‘åŠ æƒ
- ä¸éœ€è¦çŸ¥é“ç±»åˆ«ï¼Œç›´æ¥æ ¹æ®åˆ†ç±»çš„å¯ä¿¡åº¦è¿›è¡Œçš„å›°éš¾æ ·æœ¬æŒ–æ˜(Hard Example Mining), å¦‚focal lossã€‚ 

Re-weighted Cross-Entropy Loss çš„é€šç”¨å…¬å¼ï¼š
$$
loss = -\beta \cdot log\dfrac{exp(z_j)}{\sum^C_{i=1}exp(z_i)}
$$
- $z_i$: ç½‘ç»œè¾“å‡ºçš„ logits
- $\beta$: é‡åŠ æƒçš„æƒé‡ã€‚
	- ä¸æ˜¯å¸¸æ•°ï¼Œæ˜¯ä¸€ä¸ªå–å†³äºå…·ä½“å®ç°çš„ç»è¿‡è®¡ç®—çš„æƒé‡ï¼Œä¸€èˆ¬è¶‹åŠ¿æ˜¯==ç»™å¤´éƒ¨ç±»åˆ«ä½æƒé‡ï¼Œç»™å°¾éƒ¨ç±»åˆ«é«˜æƒé‡==ï¼Œåå‘æŠµæ¶ˆé•¿å°¾æ•ˆåº”
	- ä¸€èˆ¬å½¢å¼çš„ç®€å•å®ç°å½¢å¼ä¸º $\beta=g(\dfrac{\sum^C_{i=1}f(n_i)}{f(n_j)})$, $f(\cdot), g(\cdot)$ å¯ä»¥æ˜¯ä»»æ„å•è°ƒé€’å¢å‡½æ•°ï¼Œæ¯”å¦‚ log æˆ–è€…å„ç§å¹‚å¤§äº0çš„æŒ‡æ•°å‡½æ•°






## è®ºæ–‡è°ƒç ”
### é‡é‡‡æ ·
**Decoupling Representation and Classifier for Long-Tailed Recognition** _ICLR 2020_ ^dc2533

è®ºæ–‡ï¼š[Decoupling Representation and Classifier for Long-Tailed Recognition, ICLR 2020](https://arxiv.org/pdf/1910.09217)

ä»£ç ï¼š[https://github.com/facebookresearch/classifier-balancing](https://github.com/facebookresearch/classifier-balancing)

è¿™ç¯‡æ–‡ç« åº”è¯¥æ˜¯ç›®å‰é•¿å°¾å›¾ç‰‡åˆ†ç±»é¢†åŸŸçš„SOTAäº†ã€‚**è¯¥æ–‡ç« å’Œä¸‹é¢çš„BBNå…±åŒå‘ç°äº†ä¸€ä¸ªé•¿å°¾åˆ†ç±»ç ”ç©¶çš„ç»éªŒæ€§è§„å¾‹ï¼š**

> **è§„å¾‹1: å¯¹ä»»ä½•ä¸å‡è¡¡åˆ†ç±»æ•°æ®é›†åœ°å†å¹³è¡¡æœ¬è´¨éƒ½åº”è¯¥åªæ˜¯å¯¹åˆ†ç±»å™¨åœ°å†å‡è¡¡ï¼Œè€Œä¸åº”è¯¥ç”¨ç±»åˆ«çš„åˆ†å¸ƒæ”¹å˜ç‰¹å¾å­¦ä¹ æ—¶å›¾ç‰‡ç‰¹å¾çš„åˆ†å¸ƒï¼Œæˆ–è€…è¯´å›¾ç‰‡ç‰¹å¾çš„åˆ†å¸ƒå’Œç±»åˆ«æ ‡æ³¨çš„åˆ†å¸ƒï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸è€¦åˆçš„ã€‚**

åŸºäºè¿™ä¸ªè§„å¾‹ï¼ŒDecouplingå’ŒBBNæå‡ºäº†ä¸¤ç§ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼ŒDecouplingçš„æ–¹æ¡ˆæ›´ç®€å•ï¼Œå®éªŒæ›´ä¸°å¯Œ

Decouplingå°†é•¿å°¾åˆ†ç±»æ¨¡å‹çš„å­¦ä¹ åˆ†ä¸ºäº†ä¸¤æ­¥:
1. å…ˆä¸ä½œä»»ä½•å†å‡è¡¡ï¼Œè€Œæ˜¯ç›´æ¥åƒä¼ ç»Ÿçš„åˆ†ç±»ä¸€æ ·ï¼Œåˆ©ç”¨åŸå§‹æ•°æ®å­¦ä¹ ä¸€ä¸ªåˆ†ç±»æ¨¡å‹ï¼ˆåŒ…å«ç‰¹å¾æå–çš„backbone + ä¸€ä¸ªå…¨è¿æ¥åˆ†ç±»å™¨ï¼‰
2. å°†ç¬¬ä¸€æ­¥å­¦ä¹ çš„æ¨¡å‹ä¸­çš„ç‰¹å¾æå–backboneçš„å‚æ•°å›ºå®šï¼ˆä¸å†å­¦ä¹ ï¼‰ï¼Œç„¶åå•ç‹¬æ¥ä¸Šä¸€ä¸ªåˆ†ç±»å™¨ï¼ˆå¯ä»¥æ˜¯ä¸åŒäºç¬¬ä¸€æ­¥çš„åˆ†ç±»å™¨ï¼‰ï¼Œå¯¹åˆ†ç±»å™¨è¿›è¡Œclass-balanced samplingå­¦ä¹ ã€‚
æ­¤å¤–ä½œè€…è¿˜å‘ç°å…¨è¿æ¥åˆ†ç±»å™¨çš„weightçš„normå’Œå¯¹åº”ç±»åˆ«çš„æ ·æœ¬æ•°æ­£ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´æ ·æœ¬æ•°è¶Šå¤šçš„ç±»ï¼Œweightçš„æ¨¡æ›´å¤§ï¼Œä¹Ÿå°±å¯¼è‡´æœ€ç»ˆåˆ†ç±»æ—¶å¤§ç±»çš„åˆ†æ•°ï¼ˆlogitsï¼‰æ›´é«˜ï¼ˆå¯¹å¤´éƒ¨ç±»çš„è¿‡æ‹Ÿåˆï¼‰ã€‚

æ‰€ä»¥ç¬¬äºŒæ­¥çš„åˆ†ç±»å™¨ä¸ºå½’ä¸€åŒ–åˆ†ç±»å™¨ï¼Œæ–‡ç« ä¸­æœ‰ä¸¤ç§è¾ƒå¥½çš„è®¾è®¡ï¼š
1. $\bar{ğ‘¤}_ğ‘–=\dfrac{ğ‘¤_ğ‘–}{â€–ğ‘¤ğ‘–â€–^ğ‘‡}$
2. $\bar{ğ‘¤}_ğ‘–=\dfrac{ğ‘¤_ğ‘–}{ğ‘“_ğ‘–}$
å…¶ä¸­2åˆ©ç”¨äº†fixedç¬¬ä¸€æ­¥åˆ†ç±»æƒé‡$w_i$ï¼Œå¯¹æ¯ä¸ªç±»å­¦ä¹ äº†ä¸€ä¸ªåŠ æƒå‚æ•°$f_i$ã€‚

Decouplingçš„æ ¸å¿ƒåœ¨äºå›¾ç‰‡ç‰¹å¾çš„åˆ†å¸ƒå’Œç±»åˆ«åˆ†å¸ƒå…¶å®ä¸è€¦åˆï¼Œæ‰€ä»¥å­¦ä¹ backboneçš„ç‰¹å¾æå–æ—¶ä¸åº”è¯¥ç”¨ç±»åˆ«çš„åˆ†å¸ƒå»é‡é‡‡æ ·ï¼ˆre-samplingï¼‰ï¼Œè€Œåº”è¯¥ç›´æ¥åˆ©ç”¨åŸå§‹çš„æ•°æ®åˆ†å¸ƒã€‚



---
**Bilateral-Branch Network with Cumulative Learning for Long-Tailed Visual Recognition** _CVPR 2020_

è®ºæ–‡ï¼š[Bilateral-Branch Network with Cumulative Learning for Long-Tailed Visual Recognitionï¼ŒCVPR 2020](https://arxiv.org/pdf/1912.02413.pdf)
ä»£ç ï¼š[https://github.com/Megvii-Nanjing/BBN](https://github.com/Megvii-Nanjing/BBN)

BBNçš„æ ¸å¿ƒideaå’ŒDecouplingå…¶å®æ˜¯ä¸€æ ·çš„ã€‚æ­£å› ä¸ºä¸¤ä¸ªäººåŒæ—¶å‘ç°äº†åŒæ ·çš„è§„å¾‹ï¼Œæ›´è¯æ˜äº†è¿™ä¸ªè§„å¾‹çš„é€šç”¨æ€§å’Œå¯é æ€§ã€‚å…³äºä¸Šæ–‡çš„è§„å¾‹ï¼ŒBBNåšäº†æ›´è¯¦ç»†çš„åˆ†æï¼š

![](https://s1.vika.cn/space/2023/02/17/97025419abff46c5b19ba71b8cd0ab16)


è¿™ä¸ªå›¾è¯´æ˜ï¼Œé•¿å°¾åˆ†ç±»çš„æœ€ä½³ç»„åˆæ¥è‡ªäºï¼šåˆ©ç”¨Cross-Entropy Losså’ŒåŸå§‹æ•°æ®å­¦å‡ºæ¥çš„backbone + åˆ©ç”¨Re-samplingå­¦å‡ºæ¥çš„åˆ†ç±»å™¨ã€‚

å’ŒDecouplingçš„åŒºåˆ«åœ¨äºï¼ŒBBNå°†æ¨¡å‹ä¸¤æ­¥çš„å­¦ä¹ æ­¥éª¤åˆå¹¶è‡³ä¸€ä¸ªåŒåˆ†æ”¯æ¨¡å‹ã€‚è¯¥æ¨¡å‹çš„åŒåˆ†æ”¯å…±äº«å‚æ•°ï¼Œä¸€ä¸ªåˆ†æ”¯åˆ©ç”¨åŸå§‹æ•°æ®å­¦ä¹ ï¼Œå¦ä¸€ä¸ªåˆ†æ”¯åˆ©ç”¨é‡é‡‡æ ·å­¦ä¹ ï¼Œç„¶åå¯¹è¿™ä¸¤ä¸ªåˆ†æ”¯è¿›è¡ŒåŠ¨æ€åŠ æƒ(ğ›¼ ğ‘£ğ‘ .(1âˆ’ğ›¼))ã€‚è¿™æ ·éšç€æƒé‡ğ›¼çš„æ”¹å˜ï¼Œå°±å®ç°äº†è‡ªç„¶è€Œç„¶åœ°ä»stage-oneåˆ°state-twoçš„è¿‡åº¦ã€‚

![](https://s1.vika.cn/space/2023/02/17/1bbc1295b048463382fe5460edb54e7d)



### é‡åŠ æƒ

**Remix: Rebalanced Mixup**Â _Arxiv Preprint 2020_ ^021fe7

é“¾æ¥ï¼š[https://arxiv.org/abs/2007.03943](https://link.zhihu.com/?target=https%3A//arxiv.org/abs/2007.03943)

Mixupæ˜¯ä¸€ä¸ªè¿™ä¸¤å¹´å¸¸ç”¨çš„æ•°æ®å¢å¼ºæ–¹æ³•ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯¹ä¸¤ä¸ªsampleçš„input imageå’Œone-hot labelåšçº¿æ€§æ’å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°æ•°æ®ã€‚å®ç°èµ·æ¥çœ‹ä¼¼ç®€å•ï¼Œä½†æ˜¯å´éå¸¸æœ‰æ•ˆï¼Œå› ä¸ºä»–è‡ªå¸¦ä¸€ä¸ªå¾ˆå¼ºçš„çº¦æŸï¼Œå°±æ˜¯æ ·æœ¬ä¹‹é—´çš„å·®å¼‚å˜åŒ–æ˜¯çº¿æ€§çš„ï¼Œä»è€Œä¼˜åŒ–äº†ç‰¹å¾å­¦ä¹ å’Œåˆ†ç±»è¾¹ç•Œã€‚

è€ŒRemixå…¶å®å°±æ˜¯å°†ç±»åˆ«æ’å€¼çš„æ—¶å€™ï¼Œå¾€å°‘æ ·æœ¬ç±»çš„æ–¹å‘åç§»äº†ä¸€ç‚¹ï¼Œç»™å°æ ·æœ¬æ›´å¤§çš„Â Î»yÂ ã€‚

![image.png](https://s1.vika.cn/space/2023/02/17/f1bb3acbabcd4550bab43b5dfa525e2b)

![image.png](https://s1.vika.cn/space/2023/02/23/74fe179dd5ca4e7d8adde7600666a0e6)



---
**Class-Balanced Loss Based on Effective Number of Samples** _CVPR 2019_ ^dd08a6

é“¾æ¥ï¼š[https://arxiv.org/abs/1901.05555](https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1901.05555)

ä»£ç ï¼š[https://github.com/richardaecn/class-balanced-loss](https://link.zhihu.com/?target=https%3A//github.com/richardaecn/class-balanced-loss)

è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒç†å¿µåœ¨äºï¼Œéšç€æ ·æœ¬æ•°é‡çš„å¢åŠ ï¼Œæ¯ä¸ªæ ·æœ¬å¸¦æ¥çš„æ”¶ç›Šæ˜¯æ˜¾è‘—é€’å‡çš„ã€‚æ‰€ä»¥ä½œè€…é€šè¿‡ç†è®ºæ¨å¯¼ï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ›´ä¼˜çš„é‡åŠ æƒæƒé‡çš„è®¾è®¡ï¼Œä»è€Œå–å¾—æ›´å¥½çš„é•¿å°¾åˆ†ç±»æ•ˆæœã€‚

å®ç°ä¸Šï¼Œè¯¥æ–¹æ³•åœ¨Cross-Entropy Lossä¸­å¯¹å›¾ç‰‡æ ¹æ®æ‰€å±ç±»ç»™äºˆÂ 1/EnÂ çš„æƒé‡ï¼Œå…¶ä¸­Â En=(1âˆ’Î²n)/(1âˆ’Î²)Â ä»£è¡¨æœ‰æ•ˆæ ·æœ¬æ•°ï¼ŒÂ Î²=(Nâˆ’1)/NÂ ï¼ŒÂ nÂ æ˜¯ç±»åˆ«æ€»æ ·æœ¬ï¼ŒÂ NÂ åˆ™å¯ä»¥çœ‹ä½œç±»åˆ«çš„å”¯ä¸€åŸå‹æ•°ï¼ˆunique prototypesï¼‰ã€‚



---
**Long-tail learning via logit adjustment** _ICLR 2021_
- [[Long-tail learning via logit adjustment.pdf]] 
- [[Long-tail learning via logit adjustment-ppt.pdf]]

**(1) å»ºæ¨¡æ€è·¯**

æ–­å®šä¸€ä¸ªåˆ†ç±»é—®é¢˜æ˜¯å¦ä¸å‡è¡¡ï¼šä¸€èˆ¬çš„æ€è·¯æ˜¯ä»æ•´ä¸ªè®­ç»ƒé›†é‡Œè¾¹ç»Ÿè®¡å‡ºå„ä¸ªç±»åˆ«çš„é¢‘ç‡$p(y)$ï¼Œç„¶åå‘ç°$p(y)$é›†ä¸­åœ¨æŸå‡ ä¸ªç±»åˆ«ä¸­ã€‚æ‰€ä»¥ï¼Œè§£å†³ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜çš„é‡ç‚¹ï¼Œå°±æ˜¯å¦‚ä½•æŠŠè¿™ä¸ªå…ˆéªŒçŸ¥è¯†$p(y)$èå…¥æ¨¡å‹ä¹‹ä¸­ã€‚

ç›¸æ¯”æ‹Ÿåˆæ¡ä»¶æ¦‚ç‡ï¼Œå¦‚æœæ¨¡å‹èƒ½ç›´æ¥æ‹Ÿåˆ[[01 AI/lib/äº’ä¿¡æ¯ Mutual Information]]ï¼Œé‚£ä¹ˆå°†ä¼šå­¦ä¹ åˆ°æ›´æœ¬è´¨çš„çŸ¥è¯†ï¼Œå› ä¸ºäº’ä¿¡æ¯æ‰æ˜¯æ­ç¤ºæ ¸å¿ƒå…³è”çš„æŒ‡æ ‡ã€‚ä½†æ˜¯æ‹Ÿåˆäº’ä¿¡æ¯æ²¡é‚£ä¹ˆå®¹æ˜“è®­ç»ƒï¼Œå®¹æ˜“è®­ç»ƒçš„æ˜¯æ¡ä»¶æ¦‚ç‡ï¼Œç›´æ¥ç”¨äº¤å‰ç†µ $âˆ’logâ¡\ p_Î¸(y|x)$ è¿›è¡Œè®­ç»ƒå°±è¡Œäº†ã€‚æ‰€ä»¥ï¼Œä¸€ä¸ªæ¯”è¾ƒç†æƒ³çš„æƒ³æ³•å°±æ˜¯ï¼š==å¦‚ä½•ä½¿å¾—æ¨¡å‹ä¾ç„¶ä½¿ç”¨äº¤å‰ç†µä¸ºlossï¼Œä½†æœ¬è´¨ä¸Šæ˜¯åœ¨æ‹Ÿåˆäº’ä¿¡æ¯ï¼Ÿ==

åŸæœ¬æ¡ä»¶æ¦‚ç‡æ¨¡å‹ï¼š
$$
p_\theta(y|x)=\dfrac{exp(f_y(x;\theta))}{\sum_{i=1}^{K}exp(f_i(x;\theta)} \tag1
$$
æ”¹ä¸ºå»ºæ¨¡äº’ä¿¡æ¯, ä¹Ÿå°±æ˜¯å¸Œæœ›ï¼š
$$
log\dfrac{p_\theta(y|x)}{p(y)} \sim f_y(x;\theta) \Leftrightarrow log\ p_\theta(y|x) \sim f_y(x;\theta) + log\ p(y) \tag2
$$
å°†å³ç«¯è¿›è¡Œsoftmaxå½’ä¸€åŒ–ï¼Œåˆ™æœ‰ï¼š$p_\theta(y|x)=\frac{exp(f_y(x;\theta)+log\ p(y))}{\sum_{i=1}^{K}exp(f_i(x;\theta)+ log\ p(i))}$, å†™æˆlosså½¢å¼ï¼š
$$
-log\ p_\theta(y|x) = -log\dfrac{exp(f_y(x;\theta)+log\ p(y))}{\sum_{i=1}^{K}exp(f_i(x;\theta)+ log\ p(i))} = log \left[ 1 + \sum_{i\ne y}\dfrac{p(i)}{p(y)}exp(f_i(x;\theta)-f_y(x;\theta)) \right] \tag3
$$
åŸè®ºæ–‡ç§°ä¹‹ä¸º==logit adjustment loss==ã€‚å¦‚æœæ›´åŠ ä¸€èˆ¬åŒ–ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥åŠ ä¸ªè°ƒèŠ‚å› å­$Ï„$ï¼š
$$
-log\ p_\theta(y|x) = -log\dfrac{exp(f_y(x;\theta)+Ï„\ log\ p(y))}{\sum_{i=1}^{K}exp(f_i(x;\theta)+ Ï„\ log\ p(i))} = log \left[ 1 + \sum_{i\ne y}\left(\dfrac{p(i)}{p(y)}\right)^Ï„exp(f_i(x;\theta)-f_y(x;\theta)) \right] \tag4
$$

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ$Ï„=1$çš„æ•ˆæœå°±å·²ç»æ¥è¿‘æœ€ä¼˜äº†ã€‚å¦‚æœ$f_y(x;Î¸)$çš„æœ€åä¸€å±‚æœ‰biasé¡¹çš„è¯ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„å®ç°æ–¹å¼å°±æ˜¯å°†biasé¡¹åˆå§‹åŒ–ä¸º$Ï„log\ p(y)$ã€‚ä¹Ÿå¯ä»¥å†™åœ¨æŸå¤±å‡½æ•°ä¸­ï¼š
```python
import numpy as np
import keras.backend as K


def categorical_crossentropy_with_prior(y_true, y_pred, tau=1.0):
    """å¸¦å…ˆéªŒåˆ†å¸ƒçš„äº¤å‰ç†µ
    æ³¨ï¼šy_predä¸ç”¨åŠ softmax
    """
    prior = xxxxxx  # è‡ªå·±å®šä¹‰å¥½priorï¼Œshapeä¸º[num_classes]
    log_prior = K.constant(np.log(prior + 1e-8))
    for _ in range(K.ndim(y_pred) - 1):
        log_prior = K.expand_dims(log_prior, 0)
    y_pred = y_pred + tau * log_prior
    return K.categorical_crossentropy(y_true, y_pred, from_logits=True)


def sparse_categorical_crossentropy_with_prior(y_true, y_pred, tau=1.0):
    """å¸¦å…ˆéªŒåˆ†å¸ƒçš„ç¨€ç–äº¤å‰ç†µ
    æ³¨ï¼šy_predä¸ç”¨åŠ softmax
    """
    prior = xxxxxx  # è‡ªå·±å®šä¹‰å¥½priorï¼Œshapeä¸º[num_classes]
    log_prior = K.constant(np.log(prior + 1e-8))
    for _ in range(K.ndim(y_pred) - 1):
        log_prior = K.expand_dims(log_prior, 0)
    y_pred = y_pred + tau * log_prior
    return K.sparse_categorical_crossentropy(y_true, y_pred, from_logits=True)
```
å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼š
```
NotImplementedError: Cannot convert a symbolic Tensor (categorical_crossentropy_with_prior/add:0) to a numpy array. This error may indicate that you're trying to pass a Tensor to a NumPy call, which is not supported
```
å¯ä»¥å°è¯•æŠŠ1e-8å»æ‰ï¼Œä¸å‡ºç°nanå°±æ²¡æœ‰å½±å“ã€‚


**(2)ç»“æœåˆ†æ**

logit adjustment lossä¹Ÿå±äºè°ƒæ•´lossæ–¹æ¡ˆä¹‹ä¸€ï¼Œä¸åŒçš„æ˜¯å®ƒæ˜¯åœ¨loglogé‡Œè¾¹è°ƒæ•´æƒé‡ï¼Œè€Œå¸¸è§„çš„æ€è·¯åˆ™æ˜¯åœ¨loglogå¤–è°ƒæ•´ã€‚è‡³äºå®ƒçš„å¥½å¤„ï¼Œå°±æ˜¯äº’ä¿¡æ¯çš„å¥½å¤„ï¼šäº’ä¿¡æ¯æ­ç¤ºäº†çœŸæ­£é‡è¦çš„å…³è”ï¼Œæ‰€ä»¥ç»™logitsè¡¥ä¸Šå…ˆéªŒåˆ†å¸ƒçš„biasï¼Œèƒ½è®©æ¨¡å‹åšåˆ°â€œ==èƒ½é å…ˆéªŒè§£å†³çš„å°±é å…ˆéªŒè§£å†³ï¼Œå…ˆéªŒè§£å†³ä¸äº†çš„æœ¬è´¨éƒ¨åˆ†æ‰ç”±æ¨¡å‹è§£å†³==â€ã€‚




---

å‚è€ƒæ–‡ç« ï¼š
> [Long tailed é•¿å°¾åˆ†å¸ƒè®ºæ–‡æ±‡æ€» - CSDN](https://blog.csdn.net/adf1179/article/details/115691708) æœ¬æ–‡æ±‡æ€»äº†2019-2021å¹´åœ¨è®¡ç®—æœºè§†è§‰å’Œæ–‡æœ¬åˆ†ç±»æ–¹é¢çš„è®ºæ–‡
> [Long-Tailed Classification - cnblog](https://www.cnblogs.com/fusheng-rextimmy/p/15389065.html) æœ¬æ–‡ä»‹ç»äº†2019-2020å¹´è®ºæ–‡ã€æ€»ç»“äº†æŠ€æœ¯è·¯çº¿ï¼Œå¹¶æå‡ºäº†æ–°çš„æ–¹æ³•
> [è®¡ç®—æœºè§†è§‰ä¸­çš„é•¿å°¾åˆ†å¸ƒé—®é¢˜è¿˜å€¼å¾—åšå— - zhihu](https://zhuanlan.zhihu.com/p/548735583) æœ¬æ–‡ä»‹ç»22å¹´çš„ç ”ç©¶ç°çŠ¶
> [ICLR2020 | Decoupling representation and classifier for long-tailed recognition](https://zhuanlan.zhihu.com/p/452668798) è®ºæ–‡åˆ†æ
> [é€šè¿‡äº’ä¿¡æ¯æ€æƒ³æ¥ç¼“è§£ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ - è‹å‰‘æ—](https://kexue.fm/archives/7615#how_to_cite) IIDç±»é—´é•¿å°¾åˆ†ç±»é—®é¢˜å»ºæ¨¡, æœ‰å…³Long-tail learing via logit adjustment
> [longtailè®ºæ–‡ç¬”è®° - zhihu](https://zhuanlan.zhihu.com/p/403981340)
> [Long-Tail Learning via Logit Adjustment - CSDN](https://blog.csdn.net/QKK612501/article/details/126880798) è®ºæ–‡è¯„æ 
> [Remixç¬”è®° - zhihu](https://zhuanlan.zhihu.com/p/344330372) remixï¼Œä»£ç åœ¨ä¸‹é¢ä¸€ç¯‡å‚è€ƒæ–‡ç« æåˆ°çš„è®ºæ–‡ä¸­
> [é•¿å°¾åˆ†å¸ƒè®ºæ–‡ï¼ˆä¸€ï¼‰ï¼šBag of Tricks for Long-Tailed Visual Recognition with Deep Convolutional Neural Networks - zhihu](https://zhuanlan.zhihu.com/p/416315017) æ€»ç»“äº†ç”¨äºé•¿å°¾è¯†åˆ«çš„å„ç§trick, ç»™å‡ºè¯¦ç»†å®éªŒæŒ‡å—ã€‚githubå®ç°äº†å¾ˆå¤šæ–¹æ³•
