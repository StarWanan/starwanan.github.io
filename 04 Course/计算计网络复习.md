#base/计算机网络 



---

> 物理层综述不考  第七章 无线不考
> 应用层、传输层、网络层、数据链路层。 
> 聚焦在 应用层、传输层、网络层
> 第一章：10‘ ~ 20’ 
> 第三章： 20' ~ 30'
> 第四、五章 ： 20‘ ~ 30’
> 第六章：10’ ~ 20‘

> 问答题、计算题、设计题、分析题、应用题
> 基础知识
> 涉及到的计算会计算
> 分析设计：在四层都有（应用、传输、网络、数据链路）

# 01 计算机网络和因特网
> 单独出题不会出很多，但是后面需要用到第一章的很多知识

宏观概述

全局概括

计算机网络：

因特网：


## 协议分层

协议层次划分：
- 物理层
- 数据链路层
- 网络层
- 传输层
- 应用层


> 为什么分模型？分层？

利用分层体系结构可以讨论一个大而复杂系统的定义良好的特定部分。提供模块化，是的某层所提供的服务实现易于改变。而且改变服务的实现而不影响该系统其他组件。

> 层与层之间有什么联系？

发送主机端，应用层==报文==被传输给运输层。运输层收取到报文并附上附加信息。应用层报文和运输层首部信息一起构成了==运输层报文段==。运输层向网络层传递。网络层增加了源、目的端端系统地址等网络层首部信息，生成==网络层数据报==。该数据再传递给链路层，增加链路层首部信息并生成==链路层帧==。


## 描述、衡量一个网络
传输效率、吞吐率、往返时延、传输时延

时延
- 处理时延：	检查分组首部决定到向何处、价差比特差错等
- 排队时延：分组在链路上等待传输
- 传输时延：将分组的所有比特推向链路的时间
- 传播时延：两台路由器之间传播的时间

吞吐量：单位时间接收到的文件大小 == 接收文件速率


# 02 应用层
搞清楚应用层协议的原理
- 应用层协议定义了运行在不同端系统上的应用程序进程如何相互传递报文
- 应用层协议只是网络应用的一部分

## Web

Web & HTTP的区别
- Web是一种客户-服务器应用，允许客户按照需求从Web服务器获得文档。有文档格式标准（HTML）、Web浏览器、Web服务器、==应用层协议==组成。
- Web的应用层协议是HTTP，它定义了在浏览器和Web服务器之间传输报文格式和序列。

Web：一个因特网应用

## HTTP
HTTP：超文本传输协议

HTTP定义了Web客户像Web服务器请求Web页面的方式，以及服务器向客户传送Web页面的方式

HTTP支撑运输协议：TCP，提供可靠数据传输服务

#### 非持续连接 HTTP1.0
每个请求经一个单独的TCP连接发送


往返时间：RTT。一个段分组从客户到服务器然后再返回客户所花费的时间。
包括分组传播时延、分组在中间路由器和交换机上的排队时延、分组处理时延。
> 不包括传输时延？

“三次握手”建立连接
1. 客户向服务器发送一个小TCP报文段
2. 服务器用一个小TCP报文段做出确认和响应
3. 客户向服务器返回确认

#### 持续连接 HTTP1.1
所有请求及其相应经相同的TCP连接发送


### HTTP报文格式
#### 请求报文
第一行是请求行，其余行是首部行。

请求行
- 方法字段：GET、POST、HEAD、PUT、DELETE
- URL字段：请求对象的标识
- HTTP版本字段

首部行
- Host：对象所在主机。web代理告诉缓存要求的。
- Connection：close非持续链接
- User-agent：直接名用户代理（向服务器发送请求的浏览器类型）。为不同类型的用户代理发送相同对象的不同版本。

#### 响应报文
1个初始状态行，6个首部行，其余实体体

状态行
- 协议版本字段
- 状态码，相应状态信息
> 200 OK：成功
> 301 Moved Permanently：永久转移。新url在响应报文location：首部行
> 400 Bad Request：请求不能被服务器理解
> 404 Not Found：文档不在服务器上
> 505 HTTP Version Not Supported：服务器不支持请求报文的HTTP版本

首部行
- Connection：close发送报文后关闭TCP连接
- Date： 服务器产生并发送响应报文的时间
- Server：Web服务器类型（Apache）
- Last-Modified：对象创建或者最后修改的日期时间
- Content-Length：对象中的字节数
- Content-Type：text/html实体体中对象是HTML文本


---

cookie：允许站点对用户进行跟踪。cookie可以标识一个用户

---

Web缓存器（代理服务器）：代表初始Web服务器来满足HTTP请求的网络实体。

CDN：内容分发网络


## DNS
域名系统（DNS，Domain Name System）
- 一个由分层的DNS服务器实现的分布式数据库
- 一个使得主机能够查询分布式数据库的应用层协议

DNS提供的服务：
- 主机别名
- 邮件服务器别名
- 负载分配。一个ip地址集合与同一个规范主机名相联系。

![](https://s1.vika.cn/space/2022/12/12/ba109d705f694e318a7f8370b797f941)

本地DNS服务器

递归查询，迭代查询

---

DNS缓存：DNS服务器接收到一个DNS回答时，能将映射缓存在本地存储中。

---

资源记录（RR，Resource Record）：提供了主机名到IP地址的映射。每个DNS回答报文包含了一条或多条资源记录。
`(Name, Value, Type, TTL)`
TTL：记录生存时间

---

DNS报文格式。DSN的请求报文和查询报文格式一致。
![](https://s1.vika.cn/space/2022/12/12/683d6ea01b0a479d909966205c7ac773)



## wireshark分析数据报




# 03 传输层

> UDP不考

重点考TCP【rdt、GBN、SR的SFM】
## SFM





## TCP连接
> 
TCP链接建立过程和传输过程、连接释放过程
分析不理想状况，出现问题如何解决
（画图、分析）

#### 建立过程
三次握手
1. 客户首先发送一个特殊的TCP报文段
2. 服务器用另一个特殊的TCP报文段响应
3. 客户再用第三个特殊报文段进行响应
第三个报文段可以承载有效载荷

建立起一个TCP连接后，两个进程可以相互发送数据。数据流通过套接字后，就由TCP控制，将数据送入发送缓存中。
TCP从缓存中取出并放入报文段的数据数量受限于最大报文长度（MSS，Maximun Segment Size，通常由最大链路层帧长度来设置）

#### 传输过程

序号建立在传送的字节流之上
报文段的序号时该报文段首字节的字节流编号

TCP之确认该流中纸第一个丢失字节为止的字节 —— TCP提供==累计确认==

主机在TCP连接中接收到失序报文段时怎么处理？（2种）
1. 接收方立即丢弃失序报文段（简化接收方设计）
2. 保留失序字节，等待缺少的字节以填补该间隔（对网络带宽更有效）

---

报文段丢失问题
TCP与rdt协议一样，使用==超时/重传机制==处理报文段丢失问题。

超时间隔的时间设置：指数加权移动平均

---

可靠数据传输

超时间隔加倍

TCP快重传：收到对统一数据分组的3个ACK，假定数据之后的端已经丢失，在定时器超时之前就进行重传

---

#### 连接管理 ⭐
##### 三次握手建立连接
![](https://s1.vika.cn/space/2022/12/12/f4c31b32e1064c8f85e83fa568608dcb)
SYNbit = 1：连接请求确认 
Seq = x：序号。建立连接时生成的序列号保证互不相同。

ACKbit = 1：对于连接请求确认 
ACKnum = x + 1：表明x之前的都已经接受了

任何请求建立连接都需要有 SYNbit 
任何确认建立连接都需要有 ACKbit

##### 四次握手连接释放
参与一条TCP连接的两个进程中的任意一个都能终止该连接
![](https://s1.vika.cn/space/2022/12/12/069b904ae2fb4ce881a208e5467dc9cb)
FIN比特。FIN位为1的TCP段

接受FIN时，可以将ACK与自己的FIN结合，同时处理。

## TCP拥塞控制（流量控制）⭐
流量控制是假设网络可用的情况下。如果网络层没有带宽，那么就不能进行

拥塞：数据太多或者速度太快，网络无法处理
1. 数据包丢失（缓冲区溢出）
2. 延迟过长（缓冲区排队）


TCP拥塞控制
- 原理：发送方增加传输速率（窗口大小），探查可用带宽，直到发生丢失
- 事件：超时   3个重复ACK

拥塞控制在发送方执行

拥塞窗口（cwnd，congestion window）：对TCP发送方能像网络中发送流量的速率进行了限制
接收窗口（rwnd，receive window）：发送方维护，进行流量控制。给发送方指示 —— 接收方可用缓存空间


TCP拥塞控制算法
1. 慢启动
2. 拥塞避免
3. 快速恢复


# 04 网络层：数据平面

![](https://s1.vika.cn/space/2022/12/12/ed24de527c73479fa8026aa634edf249)


## ip
IPv4：32位
IPv6：128位

网络层作用：将分组从一台发送主机移动到一台接收主机

网络层
1. 转发
2. 路由选择


---

> ip怎么表示网络

分为==网络部分 + 主机部分==

> 主机之间怎么转发？ ^d22b04

转发表（FIB）：用于判断基于 IP 包的网络前缀，如何进行转发。对于每一条可达的目标网络前缀，FIB 包含接口标识符和下一跳信息。 FIB 概念上类似于路由表，它维护一份 RIB 表中的转发信息镜像。【路由表根据路由算法得出，转发表从路由表得出】

遵循 **最长掩码匹配原则**

例子
1. 来了一条ip数据包，提取目的ip
2. 查看表中是否有特殊路由
3. ip数据包中提取出目的ip，与各表项的MASK掩码做逻辑与运算，得到网络号。选择最长的匹配，Next-ID与D-IP匹配则根据 Next-Hop进行转发，不相同则向下进行匹配。 ^c06a0f
4. 查看是否有缺省路由，有则从缺省路由走，没有则转发失败。

>子网怎么划分？求主机数？

==Attention：==全1表示广播，全0表示缺省

> 超网怎么聚合？

地址聚合：单个网络前缀通告多个网络的能力
最长前缀匹配

> 路由，转发过程是怎么形成的？

路由选择算法确定路由

---

接口：主机与物理链路之间的边界
IP与一个接口相关联。
一个接口的ip地址的一部分需要由其连接的子网来决定

子网掩码：知识32比特中最左侧的 x 比特定义了子网地址

编址方案
1. 无类别域间路由选择（CIDR，Classless Interdomain Routing）：因特网的地址分配策略（地址的最高x比特表示ip地址的网络部分）
2. 分类编址（网络部分限制为8、16、24bit，分别为A、B、C类网络）

---



## SDN
 >
数据到达之后SDN怎么进行数据匹配，有什么动作，怎么转发？

匹配加动作转发表在OpenFlow中称为**流表**

- 匹配
![](https://s1.vika.cn/space/2022/12/12/ee373f1dad3e40c9b636ca0932539bbf)
入端口：分组交换机上接受分组的输入端口
流表项可以有通配符
不允许基于TTL字段或数据报长度字段的匹配

- 动作
转发：分组可以转发到特定的物理输出端口，广播到所有端口（到达端口除外），或通过所选端口集合进行多播。
丢弃：没有动作的流表项表示某个匹配的分组应当被丢弃
修改字段：分组被转发到所选的输出端口之前，除ip协议字段外的所有二、三、四层字段中的值可以重写。



## 路由器
> 队列管理（论文看一下）


# 05 网络层：控制平面
> ospf理论课不考
> 5.7不用复习。了解即可

>  路由算法

链路状态路由选择算法（LS）

距离向量路由选择算法（DV）

> BGP

外部BGP（eBGP）：跨越两个AS的BGP连接
内部BGP（iBGP）：相同AS中两台路由器之间的BGP会话



> 5.6 ICMP：因特网控制报文协议要看一下

用途：主机和路由用来批次沟通网络层信息。最典型的用途是==差错报告==


# 06 数据链路层
> 链路层交换机实验课学过，理论不考
> 虚拟局域网不考

> 数据链路层实现哪些服务？

- 成帧。
- 链路接入。媒体访问控制（MAC，Medium Access Control）协议规定了帧在链路上传输的规则
- 可靠交付。通常通过确认和重传取得。目的是本地纠正一个差错而不是重传。
- 差错检测和纠正。链路层差错检测通常复杂且用硬件实现。差错纠正能确定帧中差错出现位置。

> 数据校验的方法和原理（不考计算）

1. 奇偶校验

一个附加比特
偶校验：使 d+1 比特中1的总数是偶数
奇校验：使 d+1 比特中1的总数是奇数

二维奇偶校验
可检测和纠正单个比特差错。校验比特本身的单个比特差错也可检测和纠正
可检测两个比特差错，但是不能纠正


前向纠错：接收方检测和纠正差错的能力

2. 检验和

将k比特整数加起来，得到的和作为差错检测比特。

因特网检验和：将数据的字节作为16比特整数加起来求和。和的反码作为报文段首部的因特网检验和。

3. 循环冗余检测（CRC编码）

==生成多项式（G）==：发送方和接收方协商一个 r+1 比特模式
数据段（D），发送方选择 r 个附加比特 R，附加到D上，得到 d + r 比特模式用模2算数恰好被 G 整除 ^3a87df

CRC检测过程：接收方用 G 去初一收到的 d+r 比特。余数非零，则出差错；否则正确接收。

如何计算 R？
要求：$D * 2^r \ XOR \  R = nG$
等式两边异或上 R：$D * 2^r = nG \ XOR \  R$
所以用 G 除 $D*2^r$，余数值刚好是R：$R=remainder \frac{D*2^r}{G}$ ^e99414

每个CRC标准都能检测小于 r+1 比特的突发差错。

## 多路访问 

多路访问：协调多个发送和接收节点对一个共享广播信道的访问。
- 信道划分协议
- 随机接入协议
- 轮流协议


- 重点搞清楚CSMA/CD  
- 802.11  
- 信道共享，冲突怎么解决
- 随机接入协议
- 信道划分协议

### 信道划分协议
时分多路复用（TDM）

频分多路复用（FDM）

码分多址（CDMA）

### 随机接入协议

时隙ALOHA

ALOHA

载波侦听多路访问（CSMA）

具有碰撞检测的载波侦听多路访问（CSMA/CD）
- 信道传播时延导致了即使有==载波侦听==也会导致碰撞。传播时延越大，不能侦听到另外的节点开始传输的机会就越大。
- 二进制指数后退：在 {0 -  $2^k$} 中，等概率的选择一个时间等待。在次碰撞后，k从1开始每次++


### 轮流协议


## 交换局域网

### 链路层寻址 & ARP

链路层地址：LAN地址，物理地址，**MAC地址**。6字节，$2^{48}$个可能的MAC地址。

发送帧时：发送适配器将目的适配器的MAC地址插入到该帧中。

MAC广播地址：48个连续的1。发送适配器让局域网上所有其他适配器接受并处理它的帧。

**ARP**：地址解析协议（Address Resolution Protocol）：在因特网中，将网络层地址（ip地址）与链路层地址（MAC地址）相互转换。
- ip地址进行输入，返回相应的MAC地址。==类似于DNS==，但是不同点是：DNS在因特网的任何地方的主机解析主机名，ARP职位在同一个子网上的主机和路由接口解析ip地址。
- ARP表：ip  MAC  TTL
- 增加表项：广播ARP查询分组（广播帧），匹配的就返回响应ARP分组（标准帧），更新ARP表。


### 以太网协议
![](https://s1.vika.cn/space/2022/12/12/3ca5d3ba4d754988a7a3fe3a3b5ae25b)



## 6.7 页面请求历程（总结）

