## 一、概论

### 嵌入式系统特点

- 专用而确定的
- 实时的
- 低功耗的
- 高可靠性
- 可用资源少
- 需要专门的开发工具

### 嵌入式系统结构

- 嵌入式微处理器
- 嵌入式操作系统
- 用户的应用软件系统
- 外围硬件设备

### 处理器结构

组成：

- 控制单元：取指

- 执行单元：数据运算

结构：

- 哈佛结构：数据和指令各有各的总线。执行效率高，设计复杂度高

- 冯诺伊曼结构：存储程序原理，代码也是数据。简化了结构，降低了复杂性，总线的吞吐量成为性能提升的瓶颈

### RISC & CISC

CISC适用于复杂计算机

RISC适用于嵌入式系统。CPU-memory之间不能直接进行数据传输，需要通过store/load等指令将数据从memory移到register，CPU再操作寄存器中的数据

### 嵌入式处理器

嵌入式微处理器（MPU）

嵌入式微控制器（MCU）

嵌入式DSP处理器

嵌入式片上系统

### 典型嵌入式微处理器

ARM

MIPS

PowerPC

### 交叉编译

开发环境和运行环境不同

交叉开发环境：编译、链接、调试嵌入式应用软件的环境，与软件应用环境不同，采用宿主机/目标机方式



## 二、ARM体系结构

### IP核分类

软核

硬核

固核

### ARM处理器系列

版本号：

从V7开始系列号不再以数字命名，统一用 cortex 命名

V8首款支持64位指令集的处理器架构，两个执行状态：AArch64，AArch32

cortex系列：
A：高性能
R：实时
M：面向用户

序列号：

ARM7:三级流水，冯诺伊曼结构。

ARM8:五级流水，哈佛结构。



微处理器组成：控制部件、算术逻辑部件、寄存器组

### 命名规则

从V7之后，即使不加TDMI也默认有这个功能

T：支持Thumb指令集

D：支持片上调试Debug

M：快速乘法器 Multiplier

I：Embedded ICE

E：DSP指令

J：java加速器

S：可综合



### ARM微控制器的AMBA总线体系结构

AHB

ASB

APB



### 流水线

- 三级流水：取指、译码、执行
  <img src="https://s1.vika.cn/space/2022/06/29/0a14886dfebd4409a8051357ef960953" alt="image-20220629164528860" style="zoom:40%;" />
  <img src="https://s1.vika.cn/space/2022/06/29/9866484f748c406792a48cab75e67132" alt="image-20220629164554220" style="zoom:40%;" />

- 五级流水：取指、译码、执行、访存、回写。
  <img src="https://s1.vika.cn/space/2022/06/29/d3c1b9da67c3478fa24b3acc7666ee05" alt="image-20220629164626070" style="zoom:40%;" />

五级流水的**存储器访问**和**寄存器写操作**分别由单独的流水线处理，解决了三级流水LDR/STR指令执行阶段的延迟。
如果不是对存储器访问，本级流水线为一个空的时钟周期。 

### CISC & RISC

RICS不是简单的减少指令，而是

1. 使计算机结构更加简单
2. 合理地提高运算速度

RISC特点：

- 编码长度一致，单拍完成，便于流水操作
- 大量寄存器，只有store、load可以访问存储器

- 指令规整、对称、简单。简单寻址，基本寻址方式2～3种

### ARM和Thumb状态

#### ARM

固定的32位指令（字对其）

- 数据处理指令：MOV、AND、SUB、ADD
- 加载和存储指令：LDR、STR、LDM、STM
- 分支指令：B、BX
- 协处理器指令：LDC、STC
- 杂项指令：SWI、MRS、MSR

#### Thumb

是ARM指令集的子集，按照16位指令重新编码，固定的16位指令（半字对其）

- 分支指令
- 数据处理指令
- 寄存器加载和存储指令
- 异常产生指令

#### 状态切换

- Thumb
  - 操作数寄存器状态位[0]为1时，执行BX带状态的分支切换指令，进入Thumb状态
  - Thumb状态进入异常，当异常结束后，自动切换到Thumb状态
- ARM
  - 操作数寄存器状态位[0]为0时，执行BX带状态的分支切换指令，进入ARM状态
  - 处理器进行异常处理时，进入ARM状态，从异常向量地址处开始执行

<img src="https://s1.vika.cn/space/2022/06/29/0c323a0fb36d487fa267590eec94c870" alt="image-20220629193258788" style="zoom:50%;" />

<img src="https://s1.vika.cn/space/2022/06/29/da4529ad541c4fb0ac275e49f5d6965f" alt="image-20220629193321331" style="zoom:50%;" />



### 处理器模式

用户

系统

快中断

中断

管理

中止

未定义





## 三、ARM指令

![image-20220629202134537](https://s1.vika.cn/space/2022/06/29/f1b95c4dc3994962a2270e0271f4a800)



## 四、汇编程序设计



|         | A数字(0) | L逻辑(F) | S字符串(“”) |
| ------- | -------- | -------- | ----------- |
| GBL全局 |          |          |             |
| LCL局部 |          |          |             |
| SET赋值 |          |          |             |

RLIST: 对一个通用寄存器列表名称定义. `RegList RLIST {r0-r5, r8, r10}`





