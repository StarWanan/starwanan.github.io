姓名：朱焰星

学号：2019317220115

班级：计科1901

指导老师：武玲娟

上交日期：2022-6-14

-----

# 嵌入式系统A-作业（2）

##### 1. 寻址方式含义是什么?ARM 处理器有哪几种寻址方式?

寻址方式：处理器哥怒拒之林中给出的地址信息来寻找被操作对象的物理地址的方式

处理器的寻址方式：

- 寄存器寻址
- 立即寻址
- 寄存器移位寻址
- 寄存器间接寻址
- 基址寻址
- 多寄存器寻址
- 堆栈寻址
- 块拷贝寻址
- 相对寻址

##### 2. 块拷贝 Load/Store 指令在实现寄存器组和连续的内存单元中数据传递时，地址的变化方式有哪几种类型?分析它们的地址变化情况。

- IA 每次传送后地址加4; 

- IB 每次传送前地址加4; 

- DA 每次传送后地址减4; 

- DB 每次传送前地址减4; 

  

##### 3. 栈操作指令地址的变化方式有哪几种类型?并分析它们的地址变化情况，从而得出栈操作指令寻址 Store 指令和块拷贝 Store 指令之间的对应关系。

地址变化有两种情况：

1. 向上生长，递增堆栈
2. 向下生长，递减堆栈

- FD 满递减堆栈：堆栈指针指向最后压入的数据，且由高地址向低地址生成
- ED 空递减堆栈：堆栈指针指向下一个要压入的数据，且由高地址向低地址生成
- FA 满递增堆栈：堆栈指针指向最后压入的数据，且由低地址向高地址生成
- EA 空递增堆栈：堆栈指针指向下一个要压入的数据，且由低地址向高地址生成

对应关系：
STIA - STEA
STIB - STFA
STDA - STED
STDB - STFD



##### 4.分析下列指令操作的功能。

```c++
MOV R0, R1						# 将R1中的数据写入到R0
MOV R1, #0x198					# 将198H写入到R1
ADDEQS R1, R2, # 0Xab			# 当z=1，R1 <- R2 + 0xab，影响标识位
CMP R2, #0Xab					# R2 - 0xab，做减法运算比较，影响标识位
LDR R0, [R1, #4]				# R0 <- [R1 + 4]
STR R0, [R1, R1, LSL #2]! 		# [R1 + R1 << 2] <- R0
LDRH R0, [R1, #4]				# R0 <- [R1 + 4]，读取半字
LDRSB R0, [R2, #-2]!			# R0 <- [R2 - 2]，读取字节，r0符号扩展为32位
STRB R1, [R2, #0xA0] 			# [r2 + 0xa0] <- r1，读取字节，低8位
LDMIA R0, {R1, R2, R8} 			# 每次地址+4，[r0]~[r0+11]的数据分别赋值给r1, r2, r8
STMDB R0!, {R1-R5, R10, R11} 	# r1-r5, r10, r11的值写入[r0]的内存中，每次传送前地址减4，改变r0
STMED SP!, {R0-R3, LR}			# 将r0-r3, lr值以字为单位一次写入[sp], 空递减堆栈
```



##### 5. 如何用ARM指令实现两个64位数的加法操作，如何实现两个64位数的减法操作，如何求一个 64 位数的负数?

64位加法：

```
adds r1,r1,r3 ；r1+r3溢出 adds进位 c标志位置1
adc r0,r0,r2 ；高位相加，因为adc是带进位的加 所以高位 r0 = r0 + r2 运算结果再加 1(进位的1)
```

64位减法：

```python
subs r0, r0, r2
sbc r1, r1, r3
```

64位负数：

```python
rsbs R2, R0, #0
RSC R3, R1, #0
```



##### 6. 分析下列每条语句的功能，并确定程序段所实现的操作。

```assembly
CMP R0, #0		; 比较r0 和 0
MOVEQ R1, #0	; z=1，r1 = 0
MOVGT R1, #1	; z=0，N=V， r1 = 1

------------- 实现的功能  ------------
if r0 = 0:
	r1 = 0
else if r0 > 0:
	r1 = 1
```

##### 7. 写一条ARM指令，分别完成下列操作:


```assembly
1) R0 = 16				mov R0, #0x10
2) R0 = R1/16			ldr r0, r1, lsr#4 
3) R1 = R2*3   			mvl r2, #3
4) R0 = -R0				sbc r0, #0, r0
```

##### 8. 写出下列操作的ARM指令

1. 当Z=1时，将存储器地址为R1的字数据读入寄存器R0	`ldreq r0, [r1]`

2) 当Z=1时，将存储器地址为R1+R2的字数据读入寄存器R0  `ldreq r0, [r1, r2]`   
3) 将存储器地址为R1-4的字数据读入寄存器R0. `Ldr r0, [r1, #4]` 
4) 将存储器地址为R1+R6的字数据读入寄存器R0，并将新地址R1+R6写回 R1. `ldr r0, [r1, r6]!` 

##### 9. 用ARM汇编语言编写代码，实现将ARM处理器切换到用户模式，并关闭中断。

```assembly
; 切换到用户模式
mrs r0, cpsr
bic r0, #0x0f
msr cpsr, r0
; 关闭中断
mrs r0, cpsr
orr r0, r0, #0x80
msr cpsr, r0
```

##### 10. 与 32 位 ARM 指令集相比较，16 位的 Thumb 指令集具有哪些优势?Thumb 指令集分为哪几类?Thumb 指令集有条件执行指令吗?如果有请说明哪些指令是条件执行的。

Thumb指令集是ARM指令集的子集。ARM指令集更加完整。Thumb占用存储空间小但是此指令集能完成基本的功能需求。

所以在嵌入式的应用场景中，Thumb指令集是很合适的选择。Thumb指令集使ARM处理器能应用到有限的存储带宽而代码密度要求很高的嵌入式系统中去。

Thumb指令集：

- 分支指令 —— 有条件执行
- 数据处理指令
- 单寄存器加载和存储指令
- 多寄存器加载和存储指令

